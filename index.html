<html>
<head>
  <title>Bekti Retro-as-a-Service (RaaS)</title>
</head>
<body oncontextmenu="return false;">
  <h1>Bekti Retro-as-a-Service (RaaS)</h1>
  <canvas id="canvas-screen" width="640" height="480"></canvas>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();
    var canvas = document.getElementById('canvas-screen');
    var context = canvas.getContext('2d');

    socket.on('frame', function(payload) {
      var image = new Image();
      image.src = 'data:image/jpeg;base64,' + payload.data;
      context.drawImage(image, payload.x, payload.y);
    });

    $('#canvas-screen').mousedown(function(e) {
      var offset = $(this).offset();
      var x = (e.pageX - offset.left).toFixed(0);
      var y = (e.pageY - offset.top).toFixed(0);
      var button = e.which;
      if (button == 3) button = 4;

      var payload = {
        x: x,
        y: y,
        button: button
      };

      socket.emit('pointer', payload);
    });

    $('#canvas-screen').mouseup(function(e) {
      var offset = $(this).offset();
      var x = (e.pageX - offset.left).toFixed(0);
      var y = (e.pageY - offset.top).toFixed(0);

      var payload = {
        x: x,
        y: y,
        button: 0
      };

      socket.emit('pointer', payload);
    });

    $('#canvas-screen').mousemove(function(e) {
      var offset = $(this).offset();
      var x = (e.pageX - offset.left).toFixed(0);
      var y = (e.pageY - offset.top).toFixed(0);
      var button = e.which;
      if (button == 3) button = 4;

      var payload = {
        x: x,
        y: y,
        button: button
      };

      socket.emit('pointer', payload);
    });
  </script>
</body>
</html>
